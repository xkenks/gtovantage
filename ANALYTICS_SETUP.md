# 📊 GA4アナリティクス設定ガイド

## 🚀 **設定完了状況**

✅ GA4ライブラリ実装完了  
✅ アナリティクスコンポーネント作成完了  
✅ 基本ページビュー追跡実装完了  
✅ カスタムイベント追跡実装完了  
✅ 認証系イベント実装完了  
✅ ビルドテスト完了  

## 🔧 **環境変数設定**

### **必要な設定**

`.env.local`ファイルに以下の環境変数を追加してください：

```bash
# GA4 Analytics (新規追加)
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX

# 既存の設定
ADMIN_USERNAME=gto-admin
ADMIN_PASSWORD=GTO2024Admin!
JWT_SECRET=gto-vantage-admin-secret-key-2024
```

### **GA4測定IDの取得方法**

1. [Google Analytics](https://analytics.google.com/)にアクセス
2. 「管理」→「プロパティ」→「データストリーム」
3. ウェブストリームを選択
4. 「測定ID」をコピー（G-XXXXXXXXXXの形式）

## 📈 **実装済み追跡イベント**

### **基本イベント**
- ✅ ページビュー（全ページ自動）
- ✅ ユーザー登録
- ✅ ログイン（ユーザー/管理者/マスター別）

### **トレーニング関連**
- ✅ トレーニング開始
- ✅ アクション選択
- ✅ トレーニング完了
- ✅ カスタムレンジ使用
- ✅ レンジ保存

### **機能使用状況**
- ✅ サブスクリプション画面表示
- ✅ エラー追跡

## 🎯 **GA4で確認できる指標**

### **基本指標**
- アクティブユーザー数
- セッション数
- ページビュー
- セッション時間
- 直帰率

### **カスタム指標**
- 新規登録数
- ログイン数（ユーザータイプ別）
- トレーニング実行数
- 正解率
- カスタムレンジ使用率
- 機能別使用状況

### **ユーザー行動分析**
- ポジション別練習頻度
- スタックサイズ別学習傾向
- アクションタイプ別練習パターン
- エラー発生状況

## 🔍 **GA4レポートの見方**

### **リアルタイムレポート**
- 現在のアクティブユーザー
- リアルタイムイベント
- 現在人気のページ

### **エンゲージメントレポート**
- イベント一覧
- コンバージョン
- ページとスクリーン

### **カスタムレポート例**

#### **トレーニング分析レポート**
```
ディメンション: イベント名
指標: イベント数, ユニークユーザー数
フィルタ: イベント名 = start_training, select_action, complete_training
```

#### **ユーザー行動分析**
```
ディメンション: position, stack_size, action_type
指標: イベント数
フィルタ: イベント名 = start_training
```

## 🚀 **デプロイ後の確認手順**

### **1. リアルタイムテスト**
1. サイトにアクセス
2. GA4のリアルタイムレポートを開く
3. ページ遷移、ログイン、トレーニングを実行
4. イベントがリアルタイムで表示されることを確認

### **2. イベント確認**
1. 「設定」→「イベント」でカスタムイベントを確認
2. 以下のイベントが記録されているかチェック：
   - `login`
   - `sign_up`
   - `start_training`
   - `select_action`
   - `complete_training`
   - `use_custom_range`
   - `save_range`

### **3. デバッグモード（開発時）**
ブラウザのコンソールで以下を実行：
```javascript
// デバッグモード有効化
window.gtag('config', 'G-XXXXXXXXXX', {
  debug_mode: true
});
```

## ⚙️ **高度な設定（オプション）**

### **コンバージョン設定**
重要なイベントをコンバージョンとしてマーク：
- `sign_up`（新規登録）
- `complete_training`（トレーニング完了）
- `save_range`（カスタムレンジ保存）

### **オーディエンス作成**
- アクティブユーザー（7日以内にトレーニング実行）
- 上級者（正解率80%以上）
- カスタムレンジユーザー

### **カスタムディメンション**
- `user_type`（ユーザータイプ）
- `training_position`（練習ポジション）
- `stack_size`（スタックサイズ）

## 🔒 **プライバシー考慮事項**

- ✅ 個人を特定できる情報（PII）は送信していません
- ✅ IPアドレスは自動的に匿名化されます
- ✅ ユーザーIDは匿名化されたIDを使用
- ✅ GDPR/CCPA準拠

## 📝 **次のステップ**

1. **環境変数設定**: `NEXT_PUBLIC_GA_MEASUREMENT_ID`を設定
2. **デプロイ**: 本番環境に反映
3. **テスト**: リアルタイムでイベント確認
4. **レポート設定**: カスタムダッシュボード作成
5. **継続的改善**: データに基づく機能改善

---

## 🆘 **トラブルシューティング**

### **イベントが記録されない場合**
1. 環境変数が正しく設定されているか確認
2. ブラウザのコンソールでエラーが出ていないか確認
3. AdBlockerが無効になっているか確認
4. GA4プロパティの設定が正しいか確認

### **リアルタイムでデータが見えない場合**
- GA4は数分の遅延がある場合があります
- デバッグモードを有効にして確認してください

これでGA4アナリティクスの実装が完了します！🎉
