(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{4742:function(e,t,r){Promise.resolve().then(r.t.bind(r,9974,23)),Promise.resolve().then(r.t.bind(r,2778,23)),Promise.resolve().then(r.bind(r,8947)),Promise.resolve().then(r.bind(r,9295)),Promise.resolve().then(r.bind(r,7561)),Promise.resolve().then(r.bind(r,4362))},8947:function(e,t,r){"use strict";r.d(t,{ChakraWrapper:function(){return l}});var o=r(7437),n=r(5233),a=r(58);function l(e){let{children:t}=e,r=(0,n.F)({});return(0,o.jsx)(a.x,{value:r,children:t})}},9295:function(e,t,r){"use strict";var o=r(7437),n=r(2265),a=r(7648),l=r(9376),s=r(4362);t.default=()=>{let{user:e,logout:t}=(0,s.a)(),[r,i]=(0,n.useState)(!1),c=(0,l.usePathname)();return(0,o.jsx)("header",{className:"bg-blue-700 text-white p-4 shadow-md",children:(0,o.jsxs)("div",{className:"container mx-auto flex flex-wrap items-center justify-between",children:[(0,o.jsx)(a.default,{href:"/",className:"text-xl font-bold",children:"GTO Vantage"}),(0,o.jsx)("button",{className:"md:hidden p-2 text-white focus:outline-none",onClick:()=>i(!r),"aria-label":"メニュー",children:r?(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,o.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,o.jsx)("nav",{className:"w-full md:w-auto md:flex ".concat(r?"block":"hidden"," mt-4 md:mt-0"),children:(0,o.jsxs)("ul",{className:"flex flex-col md:flex-row md:items-center md:space-x-6",children:[(0,o.jsx)("li",{children:(0,o.jsx)(a.default,{href:"/",className:"block py-2 md:py-0 ".concat("/"===c?"font-bold":"hover:text-blue-200"),children:"ホーム"})}),e&&(0,o.jsx)("li",{children:(0,o.jsx)(a.default,{href:"/trainer/mtt",className:"block py-2 md:py-0 ".concat(c.startsWith("/trainer")?"font-bold":"hover:text-blue-200"),children:"GTOトレーナー"})}),e&&(0,o.jsx)("li",{children:(0,o.jsx)(a.default,{href:"/subscription",className:"block py-2 md:py-0 ".concat("/subscription"===c?"font-bold":"hover:text-blue-200"),children:"サブスクリプション"})}),e&&(0,o.jsx)("li",{children:(0,o.jsx)(a.default,{href:"/mypage",className:"block py-2 md:py-0 ".concat("/mypage"===c?"font-bold":"hover:text-blue-200"),children:"マイページ"})}),e?(0,o.jsx)("li",{className:"mt-4 md:mt-0 md:ml-6",children:(0,o.jsx)("button",{onClick:t,className:"block bg-transparent border border-white text-white px-4 py-1 rounded hover:bg-blue-600",children:"ログアウト"})}):(0,o.jsxs)("li",{className:"mt-4 md:mt-0 md:ml-6 flex flex-col md:flex-row",children:[(0,o.jsx)(a.default,{href:"/login",className:"block bg-transparent border border-white text-white px-4 py-1 rounded mb-2 md:mb-0 md:mr-2 text-center hover:bg-blue-600",children:"ログイン"}),(0,o.jsx)(a.default,{href:"/register",className:"block bg-white text-blue-700 px-4 py-1 rounded text-center hover:bg-gray-100",children:"新規登録"})]})]})})]})})}},7561:function(e,t,r){"use strict";r.d(t,{A:function(){return s},AdminProvider:function(){return l}});var o=r(7437),n=r(2265);let a=(0,n.createContext)(void 0);function l(e){let{children:t}=e,[r,l]=(0,n.useState)(!1),[s,i]=(0,n.useState)(null),[c,u]=(0,n.useState)(null),[d,m]=(0,n.useState)(!0),h=async e=>{let t=new AbortController,r=setTimeout(()=>t.abort(),1e4);try{let o=await fetch("/api/admin/auth",{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},signal:t.signal});if(clearTimeout(r),!o.ok)return localStorage.removeItem("admin-token"),l(!1),i(null),u(null),!1;{let t=await o.json();return l(!0),i(t.user),u(e),!0}}catch(e){return clearTimeout(r),console.error("トークン検証エラー:",e),localStorage.removeItem("admin-token"),l(!1),i(null),u(null),!1}};(0,n.useEffect)(()=>{(async()=>{{let e=localStorage.getItem("admin-token");e&&await h(e)}m(!1)})()},[]);let g=async(e,t)=>{let r=new AbortController,o=setTimeout(()=>r.abort(),15e3);try{let n=await fetch("/api/admin/auth",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},body:JSON.stringify({username:e,password:t}),signal:r.signal});if(clearTimeout(o),n.ok){let e=await n.json();return l(!0),i(e.user),u(e.token),localStorage.setItem("admin-token",e.token),!0}{let e=await n.json().catch(()=>({}));return console.warn("管理者ログイン失敗:",n.status,e),!1}}catch(e){return clearTimeout(o),e instanceof Error&&"AbortError"===e.name?console.error("管理者ログインタイムアウト"):console.error("管理者ログインエラー:",e),!1}};return(0,o.jsx)(a.Provider,{value:{isAdmin:r,user:s,token:c,login:g,logout:()=>{l(!1),i(null),u(null),localStorage.removeItem("admin-token")},loading:d},children:t})}function s(){let e=(0,n.useContext)(a);if(void 0===e)throw Error("useAdmin must be used within an AdminProvider");return e}},4362:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return i},a:function(){return l}});var o=r(7437),n=r(2265);let a=(0,n.createContext)(void 0),l=()=>{let e=(0,n.useContext)(a);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},s=["admin@gtovantage.com","master@gtovantage.com"],i=e=>{let{children:t}=e,[r,l]=(0,n.useState)(null),[i,c]=(0,n.useState)(!0),[u,d]=(0,n.useState)(0);(0,n.useEffect)(()=>{{let e=localStorage.getItem("gto-vantage-user");if(e)try{let t=JSON.parse(e);l(t)}catch(e){console.error("ユーザーデータの読み込みエラー:",e),localStorage.removeItem("gto-vantage-user")}let t=new Date().toDateString(),r=localStorage.getItem("practiceDate"),o=localStorage.getItem("practiceCount");r===t&&o?d(parseInt(o,10)):(d(0),localStorage.setItem("practiceDate",t),localStorage.setItem("practiceCount","0")),c(!1)}},[]);let m={user:r,isLoading:i,register:async(e,t,r)=>{try{let o=JSON.parse(localStorage.getItem("gto-vantage-users")||"[]");if(o.find(t=>t.email===e))throw Error("このメールアドレスは既に登録されています");let n={id:Date.now().toString(),email:e,name:r,createdAt:new Date().toISOString(),emailVerified:!1,isMasterUser:s.includes(e),subscriptionStatus:s.includes(e)?"master":"free",practiceCount:0},a=btoa(t+e);return o.push({...n,password:a}),localStorage.setItem("gto-vantage-users",JSON.stringify(o)),l(n),localStorage.setItem("gto-vantage-user",JSON.stringify(n)),!0}catch(e){return console.error("Registration failed:",e),!1}},login:async(e,t)=>{try{let r=JSON.parse(localStorage.getItem("gto-vantage-users")||"[]"),o=btoa(t+e),n=r.find(t=>t.email===e&&t.password===o);if(!n)throw Error("メールアドレスまたはパスワードが正しくありません");let a={...n};return delete a.password,l(a),localStorage.setItem("gto-vantage-user",JSON.stringify(a)),!0}catch(e){return console.error("Login failed:",e),!1}},logout:()=>{l(null),localStorage.removeItem("gto-vantage-user")},isAuthenticated:!!r,isEmailVerified:(null==r?void 0:r.emailVerified)||!1,isMasterUser:(null==r?void 0:r.isMasterUser)||!1,hasActiveSubscription:(null==r?void 0:r.subscriptionStatus)!=="free",canPractice:!!r,practiceCount:u,maxPracticeCount:(null==r?void 0:r.subscriptionStatus)==="master"?1/0:50,incrementPracticeCount:()=>{let e=u+1;d(e),localStorage.setItem("practiceCount",e.toString())},canUseStackSize:e=>!!r&&("master"===r.subscriptionStatus||"premium"===r.subscriptionStatus||("light"===r.subscriptionStatus?["10BB","15BB","20BB"].includes(e):"20BB"===e)),getAllowedStackSizes:()=>r?"master"===r.subscriptionStatus||"premium"===r.subscriptionStatus?["10BB","15BB","20BB","30BB","40BB","50BB","75BB"]:"light"===r.subscriptionStatus?["10BB","15BB","20BB"]:["20BB"]:["20BB"]};return(0,o.jsx)(a.Provider,{value:m,children:t})}},2778:function(){}},function(e){e.O(0,[635,972,618,971,117,744],function(){return e(e.s=4742)}),_N_E=e.O()}]);