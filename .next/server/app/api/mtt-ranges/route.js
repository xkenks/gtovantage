"use strict";(()=>{var e={};e.id=421,e.ids=[421],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},4017:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>q,requestAsyncStorage:()=>R,routeModule:()=>S,serverHooks:()=>N,staticGenerationAsyncStorage:()=>T});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>f,POST:()=>v});var n=r(9303),o=r(8716),a=r(670),i=r(7070),u=r(2048),c=r.n(u),p=r(5315),l=r.n(p),d=r(1482),g=r.n(d);let m=l().join(process.cwd(),"data"),x=l().join(m,"mtt-ranges.json"),y=process.env.JWT_SECRET||"gto-vantage-admin-secret-key-2024";function j(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return!1;let r=t.substring(7),s=g().verify(r,y);return"admin"===s.role}catch(e){return!1}}async function f(e){try{if(!c().existsSync(x)){let e={version:"1.0.0",lastUpdated:new Date().toISOString(),ranges:{},metadata:{totalPositions:0,totalHands:0,creator:"System",environment:"production"}};return i.NextResponse.json(e)}let e=c().readFileSync(x,"utf8"),t=JSON.parse(e);return i.NextResponse.json(t)}catch(e){return console.error("MTTレンジデータの読み込みエラー:",e),i.NextResponse.json({error:"データの読み込みに失敗しました"},{status:500})}}async function v(e){if(!j(e))return i.NextResponse.json({error:"管理者権限が必要です"},{status:403});try{let{ranges:t,metadata:r}=await e.json();if(!t||"object"!=typeof t)return i.NextResponse.json({error:"無効なレンジデータです"},{status:400});let s=Object.keys(t).length,n=Object.values(t).reduce((e,t)=>e+Object.keys(t).length,0),o={version:"1.0.0",lastUpdated:new Date().toISOString(),ranges:t,metadata:{totalPositions:s,totalHands:n,creator:r?.creator||"Admin",environment:"production"}};return c().writeFileSync(x,JSON.stringify(o,null,2)),console.log(`🔒 管理者がMTTレンジデータを保存: ${s}ポジション, ${n}ハンド`),i.NextResponse.json({success:!0,message:"システム全体にレンジデータを保存しました",metadata:o.metadata})}catch(e){return console.error("MTTレンジデータの保存エラー:",e),i.NextResponse.json({error:"データの保存に失敗しました"},{status:500})}}async function h(e){if(!j(e))return i.NextResponse.json({error:"管理者権限が必要です"},{status:403});try{return c().existsSync(x)&&c().unlinkSync(x),console.log("\uD83D\uDD12 管理者がシステム全体のレンジデータを削除しました"),i.NextResponse.json({success:!0,message:"システム全体のレンジデータを削除しました"})}catch(e){return console.error("MTTレンジデータの削除エラー:",e),i.NextResponse.json({error:"データの削除に失敗しました"},{status:500})}}c().existsSync(m)||c().mkdirSync(m,{recursive:!0});let S=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/mtt-ranges/route",pathname:"/api/mtt-ranges",filename:"route",bundlePath:"app/api/mtt-ranges/route"},resolvedPagePath:"/Users/kensuke/Desktop/gtovantage/src/app/api/mtt-ranges/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:R,staticGenerationAsyncStorage:T,serverHooks:N}=S,k="/api/mtt-ranges/route";function q(){return(0,a.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:T})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,482],()=>r(4017));module.exports=s})();