"use strict";(()=>{var e={};e.id=266,e.ids=[266],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5860:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>P,patchFetch:()=>R,requestAsyncStorage:()=>f,routeModule:()=>A,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{GET:()=>g,OPTIONS:()=>h,POST:()=>x});var n=r(9303),o=r(8716),a=r(670),u=r(7070),i=r(1482),l=r.n(i);let p=new Map,c={username:process.env.ADMIN_USERNAME||"gto-admin",password:process.env.ADMIN_PASSWORD||"GTO2024Admin!"},d=process.env.JWT_SECRET||"gto-vantage-admin-secret-key-2024";function m(e){return e.headers.set("Access-Control-Allow-Origin","*"),e.headers.set("Access-Control-Allow-Methods","GET, POST, OPTIONS"),e.headers.set("Access-Control-Allow-Headers","Content-Type, Authorization, Accept, Cache-Control"),e.headers.set("Access-Control-Max-Age","86400"),e}async function h(){return m(new u.NextResponse(null,{status:200}))}async function x(e){let t=function(e){let t=e.headers.get("x-forwarded-for"),r=e.headers.get("x-real-ip");return t?t.split(",")[0].trim():r||"unknown"}(e);try{if(!function(e){let t=Date.now(),r=p.get(e);return!r||(t-r.lastAttempt>9e5?(p.delete(e),!0):r.count<5)}(t)){console.warn(`ログイン試行が制限されました: IP ${t}`);let e=u.NextResponse.json({error:"ログイン試行回数が上限に達しました。15分後に再試行してください。"},{status:429});return m(e)}let{username:r,password:s}=await e.json();if(!r||!s){let e=u.NextResponse.json({error:"ユーザー名とパスワードが必要です"},{status:400});return m(e)}if(console.log(`認証試行: ユーザー名="${r}", IP: ${t}`),r!==c.username||s!==c.password){(function(e){let t=Date.now(),r=p.get(e)||{count:0,lastAttempt:0};r.count+=1,r.lastAttempt=t,p.set(e,r)})(t),console.warn(`認証失敗: IP ${t}, ユーザー名: ${r}, パスワード長: ${s.length}`);let e=u.NextResponse.json({error:"認証に失敗しました"},{status:401});return m(e)}p.delete(t);let n=l().sign({username:r,role:"admin",timestamp:Date.now(),ip:t},d,{expiresIn:"24h"});console.log(`管理者ログイン成功: ${r}, IP: ${t}`);let o=u.NextResponse.json({success:!0,token:n,user:{username:r,role:"admin"}});return m(o)}catch(e){return console.error(`管理者認証エラー (IP: ${t}):`,e),m(u.NextResponse.json({error:"認証処理中にエラーが発生しました"},{status:500}))}}async function g(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer ")){let e=u.NextResponse.json({error:"トークンが提供されていません"},{status:401});return m(e)}let r=t.substring(7),s=l().verify(r,d),n=u.NextResponse.json({valid:!0,user:{username:s.username,role:s.role}});return m(n)}catch(e){return m(u.NextResponse.json({error:"トークンが無効です"},{status:401}))}}let A=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/auth/route",pathname:"/api/admin/auth",filename:"route",bundlePath:"app/api/admin/auth/route"},resolvedPagePath:"/Users/kensuke/Desktop/gtovantage/src/app/api/admin/auth/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:v}=A,P="/api/admin/auth/route";function R(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,482],()=>r(5860));module.exports=s})();